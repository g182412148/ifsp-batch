<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.scrcu.ebank.ebap.batch.bean.mapper.BthMerDailyTxnCountMapper" >
  <resultMap id="BaseResultMap" type="com.scrcu.ebank.ebap.batch.bean.dto.BthMerDailyTxnCount" >
    <id column="MCHT_ID" property="mchtId" jdbcType="VARCHAR" />
    <id column="TXN_DATE" property="txnDate" jdbcType="VARCHAR" />
    <id column="FUND_CHANNEL" property="fundChannel" jdbcType="VARCHAR" />
    <result column="WEEK_FLAG" property="weekFlag" jdbcType="VARCHAR" />
    <result column="FUND_CHANNEL_NM" property="fundChannelNm" jdbcType="VARCHAR" />
    <result column="TXN_COUNT" property="txnCount" jdbcType="DECIMAL" />
    <result column="TXN_AMT" property="txnAmt" jdbcType="DECIMAL" />
    <result column="RESERVE1" property="reserve1" jdbcType="VARCHAR" />
    <result column="RESERVE2" property="reserve2" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    MCHT_ID, TXN_DATE, FUND_CHANNEL, WEEK_FLAG, FUND_CHANNEL_NM, TXN_COUNT, TXN_AMT, 
    RESERVE1, RESERVE2
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="map" >
    select 
    <include refid="Base_Column_List" />
    from BTH_MER_DAILY_TXN_COUNT
    where MCHT_ID = #{mchtId,jdbcType=VARCHAR}
      and TXN_DATE = #{txnDate,jdbcType=VARCHAR}
      and FUND_CHANNEL = #{fundChannel,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="map" >
    delete from BTH_MER_DAILY_TXN_COUNT
    where MCHT_ID = #{mchtId,jdbcType=VARCHAR}
      and TXN_DATE = #{txnDate,jdbcType=VARCHAR}
      and FUND_CHANNEL = #{fundChannel,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.scrcu.ebank.ebap.batch.bean.dto.BthMerDailyTxnCount" >
    insert into BTH_MER_DAILY_TXN_COUNT (MCHT_ID, TXN_DATE, FUND_CHANNEL, 
      WEEK_FLAG, FUND_CHANNEL_NM, TXN_COUNT, 
      TXN_AMT, RESERVE1, RESERVE2, UPD_TM
      )
    values (#{mchtId,jdbcType=VARCHAR}, #{txnDate,jdbcType=VARCHAR}, #{fundChannel,jdbcType=VARCHAR},
      #{weekFlag,jdbcType=VARCHAR}, #{fundChannelNm,jdbcType=VARCHAR}, #{txnCount,jdbcType=DECIMAL}, 
      #{txnAmt,jdbcType=DECIMAL}, #{reserve1,jdbcType=VARCHAR}, #{reserve2,jdbcType=VARCHAR}, sysdate
      )
  </insert>
  <insert id="insertSelective" parameterType="com.scrcu.ebank.ebap.batch.bean.dto.BthMerDailyTxnCount" >
    insert into BTH_MER_DAILY_TXN_COUNT
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="mchtId != null" >
        MCHT_ID,
      </if>
      <if test="txnDate != null" >
        TXN_DATE,
      </if>
      <if test="fundChannel != null" >
        FUND_CHANNEL,
      </if>
      <if test="weekFlag != null" >
        WEEK_FLAG,
      </if>
      <if test="fundChannelNm != null" >
        FUND_CHANNEL_NM,
      </if>
      <if test="txnCount != null" >
        TXN_COUNT,
      </if>
      <if test="txnAmt != null" >
        TXN_AMT,
      </if>
      <if test="reserve1 != null" >
        RESERVE1,
      </if>
      <if test="reserve2 != null" >
        RESERVE2,
      </if>
      UPD_TM
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="mchtId != null" >
        #{mchtId,jdbcType=VARCHAR},
      </if>
      <if test="txnDate != null" >
        #{txnDate,jdbcType=VARCHAR},
      </if>
      <if test="fundChannel != null" >
        #{fundChannel,jdbcType=VARCHAR},
      </if>
      <if test="weekFlag != null" >
        #{weekFlag,jdbcType=VARCHAR},
      </if>
      <if test="fundChannelNm != null" >
        #{fundChannelNm,jdbcType=VARCHAR},
      </if>
      <if test="txnCount != null" >
        #{txnCount,jdbcType=DECIMAL},
      </if>
      <if test="txnAmt != null" >
        #{txnAmt,jdbcType=DECIMAL},
      </if>
      <if test="reserve1 != null" >
        #{reserve1,jdbcType=VARCHAR},
      </if>
      <if test="reserve2 != null" >
        #{reserve2,jdbcType=VARCHAR},
      </if>
      sysdate
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.scrcu.ebank.ebap.batch.bean.dto.BthMerDailyTxnCount" >
    update BTH_MER_DAILY_TXN_COUNT
    <set >
      <if test="weekFlag != null" >
        WEEK_FLAG = #{weekFlag,jdbcType=VARCHAR},
      </if>
      <if test="fundChannelNm != null" >
        FUND_CHANNEL_NM = #{fundChannelNm,jdbcType=VARCHAR},
      </if>
      <if test="txnCount != null" >
        TXN_COUNT = #{txnCount,jdbcType=DECIMAL},
      </if>
      <if test="txnAmt != null" >
        TXN_AMT = #{txnAmt,jdbcType=DECIMAL},
      </if>
      <if test="reserve1 != null" >
        RESERVE1 = #{reserve1,jdbcType=VARCHAR},
      </if>
      <if test="reserve2 != null" >
        RESERVE2 = #{reserve2,jdbcType=VARCHAR},
      </if>
      UPD_TM = sysdate
    </set>
    where MCHT_ID = #{mchtId,jdbcType=VARCHAR}
      and TXN_DATE = #{txnDate,jdbcType=VARCHAR}
      and FUND_CHANNEL = #{fundChannel,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.scrcu.ebank.ebap.batch.bean.dto.BthMerDailyTxnCount" >
    update BTH_MER_DAILY_TXN_COUNT
    set WEEK_FLAG = #{weekFlag,jdbcType=VARCHAR},
      FUND_CHANNEL_NM = #{fundChannelNm,jdbcType=VARCHAR},
      TXN_COUNT = #{txnCount,jdbcType=DECIMAL},
      TXN_AMT = #{txnAmt,jdbcType=DECIMAL},
      RESERVE1 = #{reserve1,jdbcType=VARCHAR},
      RESERVE2 = #{reserve2,jdbcType=VARCHAR},
      UPD_TM = sysdate
    where MCHT_ID = #{mchtId,jdbcType=VARCHAR}
      and TXN_DATE = #{txnDate,jdbcType=VARCHAR}
      and FUND_CHANNEL = #{fundChannel,jdbcType=VARCHAR}
  </update>



  <select id="selectByTmAmt" resultMap="BaseResultMap" parameterType="map">
      SELECT
      MAX(MCHT_ID) AS MCHT_ID,
      FUND_CHANNEL,
      MAX(FUND_CHANNEL_NM) AS FUND_CHANNEL_NM ,
      SUM(TXN_COUNT) AS TXN_COUNT,
      SUM(TXN_AMT) AS TXN_AMT
      FROM
      BTH_MER_DAILY_TXN_COUNT
      WHERE
      TXN_DATE BETWEEN #{startTime,jdbcType=VARCHAR} AND #{endTime,jdbcType=VARCHAR}
      AND MCHT_ID = #{chlMerId,jdbcType=VARCHAR}
      GROUP BY
      FUND_CHANNEL
  </select>
  
<!-- 	List<WeekDay> queryWeekCountAll(@Param("mchtId") String mchtId,@Param("startDate") String startDate,@Param("endDate") String endDate,@Param("wookDate") String wookDate); -->
	<select id="queryWeekCountAll" resultType="com.scrcu.ebank.ebap.batch.bean.dto.WeekDay">
		select sum(txn_count) totalCount, sum(txn_amt) totalAmt, week_flag weekFlag
		  from BTH_MER_DAILY_TXN_COUNT
		  where mcht_id=#{mchtId,jdbcType=VARCHAR}
		  and txn_date between #{startDate,jdbcType=VARCHAR} and #{endDate,jdbcType=VARCHAR}
		  <if test="wookDate != null" >
		  and week_flag=#{wookDate,jdbcType=VARCHAR}
		  </if>
		 group by week_flag
	</select>
</mapper>